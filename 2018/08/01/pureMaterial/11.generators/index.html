<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-flash.min.css?v=1.0.2" rel="stylesheet">


    <link href="https://www.newraina.com/mePlayer/dist/meplayer.css" rel="stylesheet">
    <style>
        .meplayer-meta-time-tick {
            margin-top:10px !important;
        }
        .meplayer-control-play {
            right:-15px !important;
        }
        .meplayer-control-play .icon-pause {
            left:52% !important;
        }
        .meplayer-lyric {
            width: 150px !important;
            margin-left: -83px !important;
        }
    </style>






<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="google-site-verification" content="eedHk7Al-RbPChTtgjvTm8V1dET0AGyXDzxnjDCXthU" />














  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  
    
      
    

    
  

  

  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.jpg?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.jpg?v=5.1.4">


  <link rel="mask-icon" href="/images/favicon.png?v=5.1.4" color="#222">





  <meta name="keywords" content="pure material," />










<meta name="description" content="generatorsGenerator Functions and Generator ObjectsGenerators are a new feature in ES6. You declare a generator function which returns generator objects g that can then be iterated using any of Array.">
<meta name="keywords" content="pure material">
<meta property="og:type" content="article">
<meta property="og:title" content="11.generators">
<meta property="og:url" content="www.lpldplws.cn/2018/08/01/pureMaterial/11.generators/index.html">
<meta property="og:site_name" content="Frankl&#39;s Personal Blog">
<meta property="og:description" content="generatorsGenerator Functions and Generator ObjectsGenerators are a new feature in ES6. You declare a generator function which returns generator objects g that can then be iterated using any of Array.">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2018-08-01T05:54:55.053Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="11.generators">
<meta name="twitter:description" content="generatorsGenerator Functions and Generator ObjectsGenerators are a new feature in ES6. You declare a generator function which returns generator objects g that can then be iterated using any of Array.">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: 'undefined',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="www.lpldplws.cn/2018/08/01/pureMaterial/11.generators/"/>





  <title>11.generators | Frankl's Personal Blog</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-121839770-1', 'auto');
  ga('send', 'pageview');
</script>





</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  
  <img src='http://www.lpldplws.cn/images/favicon.jpg' style="display:none;"/>
  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Frankl's Personal Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="www.lpldplws.cn/2018/08/01/pureMaterial/11.generators/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Frankl">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/favicon.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Frankl's Personal Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">11.generators</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-01T15:58:47+08:00">
                2018-08-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/pure-material/" itemprop="url" rel="index">
                    <span itemprop="name">pure material</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/08/01/pureMaterial/11.generators/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count fb-comments-count" data-href="www.lpldplws.cn/2018/08/01/pureMaterial/11.generators/" itemprop="commentCount">0</span> comments
                </a>
              </span>
            
          

          
          
             <span id="/2018/08/01/pureMaterial/11.generators/" class="leancloud_visitors" data-flag-title="11.generators">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="generators"><a href="#generators" class="headerlink" title="generators"></a>generators</h2><h2 id="Generator-Functions-and-Generator-Objects"><a href="#Generator-Functions-and-Generator-Objects" class="headerlink" title="Generator Functions and Generator Objects"></a><a href="#generator-functions-and-generator-objects">Generator Functions and Generator Objects</a></h2><p>Generators are a new feature in ES6. You declare a <em>generator function</em> which returns generator objects <code>g</code> that can then be iterated using any of <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/from" target="_blank" rel="noopener"><code>Array.from(g)</code></a>, <a href="/articles/es6-spread-and-butter-in-depth"><code>[...g]</code></a>, or <a href="/articles/es6-iterators-in-depth"><code>for value of g</code></a> loops. Generator functions allow you to declare a special kind of <em>iterator</em>. These iterators can suspend execution while retaining their context. We already examined iterators in <a href="/articles/es6-iterators-in-depth">the previous article</a> and how their <code>.next()</code> method is called once at a time to pull values from a sequence.</p>
<p>Here is an example generator function. Note the <code>*</code> after <code>function</code>. That’s not a typo, that’s how you mark a generator function as a <em>generator</em>.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">generator</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'f'</span></span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'o'</span></span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'o'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Generator objects conform to both the <em>iterable</em> protocol and the <em>iterator</em> protocol. This means…</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> g = generator()</span><br><span class="line"><span class="comment">// a generator object g is built using the generator function</span></span><br><span class="line"><span class="keyword">typeof</span> g[<span class="built_in">Symbol</span>.iterator] === <span class="string">'function'</span></span><br><span class="line"><span class="comment">// it's an iterable because it has an @@iterator</span></span><br><span class="line"><span class="keyword">typeof</span> g.next === <span class="string">'function'</span></span><br><span class="line"><span class="comment">// it's also an iterator because it has a .next method</span></span><br><span class="line">g[<span class="built_in">Symbol</span>.iterator]() === g</span><br><span class="line"><span class="comment">// the iterator for a generator object is the generator object itself</span></span><br><span class="line"><span class="built_in">console</span>.log([...g])</span><br><span class="line"><span class="comment">// &lt;- ['f', 'o', 'o']</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Array</span>.from(g))</span><br><span class="line"><span class="comment">// &lt;- ['f', 'o', 'o']</span></span><br></pre></td></tr></table></figure>
<p><em>(This article is starting to sound an awful lot like a Math course…)</em></p>
<p>When you create a generator object <em>(I’ll just call them “generator” from here on out)</em>, you’ll get an <em>iterator</em> that uses the generator to produce its <em>sequence</em>. Whenever a <code>yield</code> expression is reached, that value is emitted by the iterator and <strong>function execution is suspended</strong>.</p>
<p>Let’s use a different example, this time with some other statements mixed in between <code>yield</code> expressions. This is a simple generator but it behaves in an interesting enough way for our purposes here.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">generator</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'p'</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'o'</span>)</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'n'</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'y'</span>)</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'f'</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'o'</span>)</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'o'</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'!'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>If we use a <code>for..of</code> loop, this will print <code>ponyfoo!</code> one character at a time, as expected.</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">var foo = generator()</span><br><span class="line"><span class="keyword">for</span> (let pony of foo) &#123;</span><br><span class="line">  console.log(pony)</span><br><span class="line">  <span class="regexp">//</span> &lt;- <span class="string">'p'</span></span><br><span class="line">  <span class="regexp">//</span> &lt;- <span class="string">'o'</span></span><br><span class="line">  <span class="regexp">//</span> &lt;- <span class="string">'n'</span></span><br><span class="line">  <span class="regexp">//</span> &lt;- <span class="string">'y'</span></span><br><span class="line">  <span class="regexp">//</span> &lt;- <span class="string">'f'</span></span><br><span class="line">  <span class="regexp">//</span> &lt;- <span class="string">'o'</span></span><br><span class="line">  <span class="regexp">//</span> &lt;- <span class="string">'o'</span></span><br><span class="line">  <span class="regexp">//</span> &lt;- <span class="string">'!'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>What about using the spread <code>[...foo]</code> syntax? Things turn out a little different here. This might be a little unexpected, but that’s how generators work, everything that’s not yielded ends up becoming <strong>a side effect</strong>. As the sequence is being constructed, the <code>console.log</code> statements in between <code>yield</code> calls are executed, and they print characters to the console before <code>foo</code> is spread over an array. The previous example worked because we were printing characters as soon as they were pulled from the sequence, instead of waiting to construct a range for the entire sequence first.</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var foo = generator()</span><br><span class="line">console.log([...foo])</span><br><span class="line"><span class="regexp">//</span> &lt;- <span class="string">'o'</span></span><br><span class="line"><span class="regexp">//</span> &lt;- <span class="string">'y'</span></span><br><span class="line"><span class="regexp">//</span> &lt;- <span class="string">'o'</span></span><br><span class="line"><span class="regexp">//</span> &lt;- <span class="string">'!'</span></span><br><span class="line"><span class="regexp">//</span> &lt;- [<span class="string">'p'</span>, <span class="string">'n'</span>, <span class="string">'f'</span>, <span class="string">'o'</span>]</span><br></pre></td></tr></table></figure>
<p>A neat aspect of generator functions is that you can also use <code>yield*</code> to delegate to another generator function. Want a very contrived way to split <code>&#39;ponyfoo&#39;</code> into individual characters? Since strings in ES6 adhere to the <em>iterable</em> protocol, you could do the following.</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">generator</span> <span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="built_in">yield</span>* <span class="string">'ponyfoo'</span></span><br><span class="line">&#125;</span><br><span class="line">console.<span class="built_in">log</span>([...generator()])</span><br><span class="line">// &lt;- [<span class="string">'p'</span>, <span class="string">'o'</span>, <span class="string">'n'</span>, <span class="string">'y'</span>, <span class="string">'f'</span>, <span class="string">'o'</span>, <span class="string">'o'</span>]</span><br></pre></td></tr></table></figure>
<p>Of course, in the real world you could just do <code>[...&#39;ponyfoo&#39;]</code>, since spread supports iterables just fine. Just like you could <code>yield*</code> a string, you can <code>yield*</code> anything that adheres to the iterable protocol. That includes other generators, arrays, and come ES6 – <em>just about anything.</em></p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">var foo = &#123;</span><br><span class="line">  [Symbol.iterator]: () =&gt; (&#123;</span><br><span class="line">    items: [<span class="string">'p'</span>, <span class="string">'o'</span>, <span class="string">'n'</span>, <span class="string">'y'</span>, <span class="string">'f'</span>, <span class="string">'o'</span>, <span class="string">'o'</span>],</span><br><span class="line">    <span class="built_in">next</span>: <span class="function"><span class="keyword">function</span> <span class="title">next</span> <span class="params">()</span></span> &#123;</span><br><span class="line">      <span class="keyword">return</span> &#123;</span><br><span class="line">        done: this.items.length === <span class="number">0</span>,</span><br><span class="line">        value: this.items.shift()</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">multiplier</span> <span class="params">(value)</span></span> &#123;</span><br><span class="line">  <span class="built_in">yield</span> value * <span class="number">2</span></span><br><span class="line">  <span class="built_in">yield</span> value * <span class="number">3</span></span><br><span class="line">  <span class="built_in">yield</span> value * <span class="number">4</span></span><br><span class="line">  <span class="built_in">yield</span> value * <span class="number">5</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">trailmix</span> <span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="built_in">yield</span> <span class="number">0</span></span><br><span class="line">  <span class="built_in">yield</span>* [<span class="number">1</span>, <span class="number">2</span>]</span><br><span class="line">  <span class="built_in">yield</span>* [...multiplier(<span class="number">2</span>)]</span><br><span class="line">  <span class="built_in">yield</span>* multiplier(<span class="number">3</span>)</span><br><span class="line">  <span class="built_in">yield</span>* foo</span><br><span class="line">&#125;</span><br><span class="line">console.<span class="built_in">log</span>([...trailmix()])</span><br><span class="line">// &lt;- [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">12</span>, <span class="number">15</span>, <span class="string">'p'</span>, <span class="string">'o'</span>, <span class="string">'n'</span>, <span class="string">'y'</span>, <span class="string">'f'</span>, <span class="string">'o'</span>, <span class="string">'o'</span>]</span><br></pre></td></tr></table></figure>
<p>You could also iterate the sequence by hand, calling <code>.next()</code>. This approach gives you the most control over the iteration, but it’s also the most involved. There’s a few features you can leverage here that give you even more control over the iteration.</p>
<h2 id="Iterating-Over-Generators-by-Hand"><a href="#Iterating-Over-Generators-by-Hand" class="headerlink" title="Iterating Over Generators by Hand"></a><a href="#iterating-over-generators-by-hand">Iterating Over Generators by Hand</a></h2><p>Besides iterating over <code>trailmix</code> as we’ve already covered, using <code>[...trailmix()]</code>, <code>for value of trailmix()</code>, and <code>Array.from(trailmix())</code>, we could use the generator returned by <code>trailmix()</code> directly, and iterate over that. But <code>trailmix</code> was an overcomplicated showcase of <code>yield*</code>, let’s go back to the <em>side-effects</em> <code>generator</code> for this one.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">generator</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'p'</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'o'</span>)</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'n'</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'y'</span>)</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'f'</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'o'</span>)</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'o'</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'!'</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> g = generator()</span><br><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> item = g.next()</span><br><span class="line">  <span class="keyword">if</span> (item.done) &#123;</span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(item.value)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Just like we <a href="/articles/es6-iterators-in-depth">learned yesterday</a>, any items returned by an iterator will have a <code>done</code> property that indicates whether the sequence has reached its end, and a <code>value</code> indicating the current value in the sequence.</p>
<blockquote>
<p>If you’re confused as to <strong>why the <code>&#39;!&#39;</code> is printed</strong> even though there are no more <code>yield</code> expressions after it, that’s because <code>g.next()</code> doesn’t know that. The way it works is that each time its called, it executes the method until a <code>yield</code> expression is reached, emits its value and <em>suspends execution</em>. The next time <code>g.next()</code> is called, _execution is resumed _from where it left off <em>(the last <code>yield</code> expression)</em>, until the next <code>yield</code> expression is reached. When no <code>yield</code> expression is reached, the generator returns <code>{ done: true }</code>, signaling that the sequence has ended. At this point, the <code>console.log(&#39;!&#39;)</code> statement has been already executed, though.</p>
<p>It’s also worth noting that <strong>context is preserved</strong> across suspensions and resumptions. That means generators can be stateful. Generators are, in fact, the underlying implementation for <code>async</code>/<code>await</code> semantics coming in ES7.</p>
</blockquote>
<p>Whenever <code>.next()</code> is called on a generator, there’s four “events” that will suspend execution in the generator, returning an <em><code>IteratorResult</code></em> to the caller of <code>.next()</code>.</p>
<ul>
<li>A <code>yield</code> expression returning the <em>next</em> value in the sequence</li>
<li>A <code>return</code> statement returning the <em>last</em> value in the sequence</li>
<li>A <code>throw</code> statement halts execution in the generator entirely</li>
<li>Reaching the end of the generator function signals <code>{ done: true }</code></li>
</ul>
<p>Once the <code>g</code> generator ended iterating over a sequence, subsequent calls to <code>g.next()</code> will have no effect and just return <code>{ done: true }</code>.</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">generator</span> <span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="built_in">yield</span> <span class="string">'only'</span></span><br><span class="line">&#125;</span><br><span class="line">var g = generator()</span><br><span class="line">console.<span class="built_in">log</span>(g.<span class="built_in">next</span>())</span><br><span class="line">// &lt;- &#123; done: <span class="literal">false</span>, value: <span class="string">'only'</span> &#125;</span><br><span class="line">console.<span class="built_in">log</span>(g.<span class="built_in">next</span>())</span><br><span class="line">// &lt;- &#123; done: <span class="literal">true</span> &#125;</span><br><span class="line">console.<span class="built_in">log</span>(g.<span class="built_in">next</span>())</span><br><span class="line">// &lt;- &#123; done: <span class="literal">true</span> &#125;</span><br></pre></td></tr></table></figure>
<h2 id="Generators-The-Weird-Awesome-Parts"><a href="#Generators-The-Weird-Awesome-Parts" class="headerlink" title="Generators: The Weird Awesome Parts"></a><a href="#generators-the-del-weird-del-ins-awesome-ins-parts">Generators: The Weird <em>Awesome</em> Parts</a></h2><p>Generator objects come with a couple more methods besides <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Generator/next" target="_blank" rel="noopener"><code>.next</code></a>. These are <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Generator/return" target="_blank" rel="noopener"><code>.return</code></a> and <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Generator/throw" target="_blank" rel="noopener"><code>.throw</code></a>. We’ve already covered <code>.next</code> extensively, but not quite. You could also use <code>.next(value)</code> to send values <em>into the generator</em>.</p>
<p>Let’s make <strong>a magic 8-ball generator</strong>. First off, you’ll need some answers. Wikipedia obliges, yielding <a href="https://en.wikipedia.org/wiki/Magic_8-Ball#Possible_answers" target="_blank" rel="noopener">20 possible answers</a> for our magic 8-ball.</p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">var answers = [</span><br><span class="line">  `It is certain`, `It is decidedly so`, `Without <span class="literal">a</span> doubt`,</span><br><span class="line">  `Yes definitely`, `You may rely on it`, `As I see it, yes`,</span><br><span class="line">  `Most likely`, `Outlook good`, `Yes`, `Signs point to yes`,</span><br><span class="line">  `Reply hazy try again`, `Ask again later`, `Better <span class="literal">not</span> tell you now`,</span><br><span class="line">  `Cannot predict now`, `Concentrate <span class="literal">and</span> ask again`,</span><br><span class="line">  `Don't count on it`, `My reply is no`, `My sources say no`,</span><br><span class="line">  `Outlook <span class="literal">not</span> so good`, `Very doubtful`</span><br><span class="line">]</span><br><span class="line">function answer () &#123;</span><br><span class="line">  <span class="keyword">return</span> answers[Math.floor(Math.random() * answers.length)]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The following generator function can act as a <em>“genie”</em> that answers any questions you might have for them. Note how we discard the first result from <code>g.next()</code>. That’s because the first call to <code>.next</code> enters the generator and there’s no <code>yield</code> expression waiting to capture the <code>value</code> from <code>g.next(value)</code>.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">chat</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> question = <span class="keyword">yield</span> <span class="string">'[Genie] '</span> + answer()</span><br><span class="line">    <span class="built_in">console</span>.log(question)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> g = chat()</span><br><span class="line">g.next()</span><br><span class="line"><span class="built_in">console</span>.log(g.next(<span class="string">'[Me] Will ES6 die a painful death?'</span>).value)</span><br><span class="line"><span class="comment">// &lt;- '[Me] Will ES6 die a painful death?'</span></span><br><span class="line"><span class="comment">// &lt;- '[Genie] My sources say no'</span></span><br><span class="line"><span class="built_in">console</span>.log(g.next(<span class="string">'[Me] How youuu doing?'</span>).value)</span><br><span class="line"><span class="comment">// &lt;- '[Me] How youuu doing?'</span></span><br><span class="line"><span class="comment">// &lt;- '[Genie] Concentrate and ask again'</span></span><br></pre></td></tr></table></figure>
<p>Randomly dropping <code>g.next()</code> feels like a very dirty coding practice, though. What else could we do? We could flip responsibilities around.</p>
<h3 id="Inversion-of-Control"><a href="#Inversion-of-Control" class="headerlink" title="Inversion of Control"></a><a href="#inversion-of-control">Inversion of Control</a></h3><p>We could have the Genie be in control, and have the generator ask the questions. How would that look like? At first, you might think that the code below is unconventional, but in fact, most libraries built around generators work by inverting responsibility.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">chat</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'[Me] Will ES6 die a painful death?'</span></span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'[Me] How youuu doing?'</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> g = chat()</span><br><span class="line"><span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> question = g.next()</span><br><span class="line">  <span class="keyword">if</span> (question.done) &#123;</span><br><span class="line">    <span class="keyword">break</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(question.value)</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'[Genie] '</span> + answer())</span><br><span class="line">  <span class="comment">// &lt;- '[Me] Will ES6 die a painful death?'</span></span><br><span class="line">  <span class="comment">// &lt;- '[Genie] Very doubtful'</span></span><br><span class="line">  <span class="comment">// &lt;- '[Me] How youuu doing?'</span></span><br><span class="line">  <span class="comment">// &lt;- '[Genie] My reply is no'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>You would expect the <strong>generator to do the heavy lifting</strong> of an iteration, but in fact generators make it easy to iterate over things by suspending execution of themselves – and deferring the heavy lifting. That’s one of the most powerful aspects of generators. Suppose now that the iterator is a <code>genie</code> method in a library, like so:</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">genie</span> (<span class="params">questions</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> g = questions()</span><br><span class="line">  <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">    <span class="keyword">let</span> question = g.next()</span><br><span class="line">    <span class="keyword">if</span> (question.done) &#123;</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(question.value)</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'[Genie] '</span> + answer())</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>To use it, all you’d have to do is pass in a simple generator like the one we just made.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">genie(<span class="function"><span class="keyword">function</span>* <span class="title">questions</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'[Me] Will ES6 die a painful death?'</span></span><br><span class="line">  <span class="keyword">yield</span> <span class="string">'[Me] How youuu doing?'</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>Compare that to the generator we had before, where questions were sent to the generator instead of the other way around. See how much more complicated the logic would have to be to achieve the same goal? Letting the library deal with the flow control means you can <strong>just worry about the <em>thing</em> you want to iterate</strong> over, and you can <strong>delegate <em>how</em> to iterate over it</strong>. But yes, it does mean your code now has an asterisk in it. <em>Weird.</em></p>
<h3 id="Dealing-with-asynchronous-flows"><a href="#Dealing-with-asynchronous-flows" class="headerlink" title="Dealing with asynchronous flows"></a><a href="#dealing-with-asynchronous-flows">Dealing with asynchronous flows</a></h3><p>Imagine now that the <code>genie</code> library gets its magic 8-ball answers from an API. How does that look then? Probably something like the snippet below. Assume the <a href="https://github.com/Raynos/xhr" target="_blank" rel="noopener"><code>xhr</code></a> pseudocode call always yields JSON responses like <code>{ answer: &#39;No&#39; }</code>. Keep in mind this is a simple example that just processes each question in series. You could put together different and more complex flow control algorithms depending on what you’re looking for.</p>
<p>This is just a demonstration of the sheer power of generators.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">genie</span> (<span class="params">questions</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> g = questions()</span><br><span class="line">  pull()</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">pull</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> question = g.next()</span><br><span class="line">    <span class="keyword">if</span> (question.done) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    ask(question.value, pull)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">ask</span> (<span class="params">q, next</span>) </span>&#123;</span><br><span class="line">    xhr(<span class="string">'https://computer.genie/?q='</span> + <span class="built_in">encodeURIComponent</span>(q), got)</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">got</span> (<span class="params">err, res, body</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="comment">// todo</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">console</span>.log(q)</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'[Genie] '</span> + body.answer)</span><br><span class="line">      next()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>See <a href="http://buff.ly/1UimWsZ" target="_blank" rel="noopener">this link for a live demo</a> on the Babel REPL</p>
<p>Even though we’ve just made our <code>genie</code> method asynchronous and are now using an API to fetch responses to the user’s questions, the way the consumer uses the <code>genie</code> library by passing a <code>questions</code> generator function <em>remains unchanged!</em> That’s awesome.</p>
<p>We haven’t handled the case for an <code>err</code> coming out of the API. That’s inconvenient. What can we do about that one?</p>
<h3 id="Throwing-at-a-Generator"><a href="#Throwing-at-a-Generator" class="headerlink" title="Throwing at a Generator"></a><a href="#throwing-at-a-generator">Throwing <em>at</em> a Generator</a></h3><p>Now that we’ve figured out that the most important aspect of generators is <em>actually the control flow code</em> that decides when to call <code>g.next()</code>, we can look at the other two methods and actually understand their purpose. Before shifting our thinking into <em>“the generator defines <strong>what</strong> to iterate over, not the <strong>how</strong>”</em>, we would’ve been hard pressed to find a user case for <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Generator/throw" target="_blank" rel="noopener"><code>g.throw</code></a>. Now however it seems immediately obvious. The flow control that leverages a generator needs to be able to tell the generator that’s yielding the sequence to be iterated when something goes wrong processing an item in the sequence.</p>
<p>In the case of our <code>genie</code> flow, that is now using <a href="https://github.com/Raynos/xhr" target="_blank" rel="noopener"><code>xhr</code></a>, we may experience network issues and be unable to continue processing items, or we may want to warn the user about unexpected errors. Here’s how, we simply add <code>g.throw(error)</code> in our control flow code.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">genie</span> (<span class="params">questions</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> g = questions()</span><br><span class="line">  pull()</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">pull</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> question = g.next()</span><br><span class="line">    <span class="keyword">if</span> (question.done) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    ask(question.value, pull)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">ask</span> (<span class="params">q, next</span>) </span>&#123;</span><br><span class="line">    xhr(<span class="string">'https://computer.genie/?q='</span> + <span class="built_in">encodeURIComponent</span>(q), got)</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">got</span> (<span class="params">err, res, body</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        g.throw(err)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">console</span>.log(q)</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">'[Genie] '</span> + body.answer)</span><br><span class="line">      next()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The <em>user code</em> is still unchanged, though. In between <code>yield</code> statements it may throw errors now. You could use <code>try</code>/<code>catch</code> blocks to address those issues. If you do this, execution will be able to resume. The good thing is that this is up to the user, it’s still perfectly sequential on their end, and they can leverage <code>try</code>/<code>catch</code> semantics just like in high-school.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">genie(<span class="function"><span class="keyword">function</span>* <span class="title">questions</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="string">'[Me] Will ES6 die a painful death?'</span></span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(<span class="string">'Error'</span>, e.message)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="keyword">yield</span> <span class="string">'[Me] How youuu doing?'</span></span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    <span class="built_in">console</span>.error(<span class="string">'Error'</span>, e.message)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="Returning-on-Behalf-of-a-Generator"><a href="#Returning-on-Behalf-of-a-Generator" class="headerlink" title="Returning on Behalf of a Generator"></a><a href="#returning-on-behalf-of-a-generator">Returning on Behalf of a Generator</a></h3><p>Usually not as interesting in asynchronous control flow mechanisms in general, the <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Generator/return" target="_blank" rel="noopener"><code>g.return()</code></a> method allows you to resume execution inside a generator function, much like <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Generator/throw" target="_blank" rel="noopener"><code>g.throw()</code></a> did moments earlier. The key difference is that <code>g.return()</code> won’t result in an exception at the generator level, although <strong>it will end the sequence.</strong></p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">numbers</span> <span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="built_in">yield</span> <span class="number">1</span></span><br><span class="line">  <span class="built_in">yield</span> <span class="number">2</span></span><br><span class="line">  <span class="built_in">yield</span> <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line">var g = numbers()</span><br><span class="line">console.<span class="built_in">log</span>(g.<span class="built_in">next</span>())</span><br><span class="line">// &lt;- &#123; done: <span class="literal">false</span>, value: <span class="number">1</span> &#125;</span><br><span class="line">console.<span class="built_in">log</span>(g.<span class="keyword">return</span>())</span><br><span class="line">// &lt;- &#123; done: <span class="literal">true</span> &#125;</span><br><span class="line">console.<span class="built_in">log</span>(g.<span class="built_in">next</span>())</span><br><span class="line">// &lt;- &#123; done: <span class="literal">true</span> &#125;, as we know</span><br></pre></td></tr></table></figure>
<p>You could also return a <code>value</code> using <code>g.return(value)</code>, and the resulting <code>IteratorResult</code> will contain said <code>value</code>. This is equivalent to having <code>return value</code> somewhere in the generator function. You should be careful there though – as neither <code>for..of</code>, <code>[...generator()]</code>, nor <code>Array.from(generator())</code> include the <code>value</code> in the <code>IteratorResult</code> that signals <code>{ done: true }</code>.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">numbers</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">yield</span> <span class="number">1</span></span><br><span class="line">  <span class="keyword">yield</span> <span class="number">2</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">3</span></span><br><span class="line">  <span class="keyword">yield</span> <span class="number">4</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log([...numbers()])</span><br><span class="line"><span class="comment">// &lt;- [1, 2]</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">Array</span>.from(numbers()))</span><br><span class="line"><span class="comment">// &lt;- [1, 2]</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> n <span class="keyword">of</span> numbers()) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(n)</span><br><span class="line">  <span class="comment">// &lt;- 1</span></span><br><span class="line">  <span class="comment">// &lt;- 2</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> g = numbers()</span><br><span class="line"><span class="built_in">console</span>.log(g.next())</span><br><span class="line"><span class="comment">// &lt;- &#123; done: false, value: 1 &#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(g.next())</span><br><span class="line"><span class="comment">// &lt;- &#123; done: false, value: 2 &#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(g.next())</span><br><span class="line"><span class="comment">// &lt;- &#123; done: true, value: 3 &#125;</span></span><br><span class="line"><span class="built_in">console</span>.log(g.next())</span><br><span class="line"><span class="comment">// &lt;- &#123; done: true &#125;</span></span><br></pre></td></tr></table></figure>
<p>Using <code>g.return</code> is no different in this regard, think of it as the programmatic equivalent of what we just did.</p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">numbers</span> <span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="built_in">yield</span> <span class="number">1</span></span><br><span class="line">  <span class="built_in">yield</span> <span class="number">2</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">3</span></span><br><span class="line">  <span class="built_in">yield</span> <span class="number">4</span></span><br><span class="line">&#125;</span><br><span class="line">var g = numbers()</span><br><span class="line">console.<span class="built_in">log</span>(g.<span class="built_in">next</span>())</span><br><span class="line">// &lt;- &#123; done: <span class="literal">false</span>, value: <span class="number">1</span> &#125;</span><br><span class="line">console.<span class="built_in">log</span>(g.<span class="keyword">return</span>(<span class="number">5</span>))</span><br><span class="line">// &lt;- &#123; done: <span class="literal">true</span>, value: <span class="number">5</span> &#125;</span><br><span class="line">console.<span class="built_in">log</span>(g.<span class="built_in">next</span>())</span><br><span class="line">// &lt;- &#123; done: <span class="literal">true</span> &#125;</span><br></pre></td></tr></table></figure>
<p>You can avoid the impending sequence termination, <a href="http://www.2ality.com/2015/03/es6-generators.html" target="_blank" rel="noopener">as Axel points out</a>, if the code in the generator function when <code>g.return()</code> got called is wrapped in <code>try</code>/<code>finally</code>. Once the <code>yield</code> expressions in the <code>finally</code> block are over, the sequence <em>will</em> end with the <code>value</code> passed to <code>g.return(value)</code></p>
<figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span>* <span class="title">numbers</span> <span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="built_in">yield</span> <span class="number">1</span></span><br><span class="line">  try &#123;</span><br><span class="line">    <span class="built_in">yield</span> <span class="number">2</span></span><br><span class="line">  &#125; finally &#123;</span><br><span class="line">    <span class="built_in">yield</span> <span class="number">3</span></span><br><span class="line">    <span class="built_in">yield</span> <span class="number">4</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">yield</span> <span class="number">5</span></span><br><span class="line">&#125;</span><br><span class="line">var g = numbers()</span><br><span class="line">console.<span class="built_in">log</span>(g.<span class="built_in">next</span>())</span><br><span class="line">// &lt;- &#123; done: <span class="literal">false</span>, value: <span class="number">1</span> &#125;</span><br><span class="line">console.<span class="built_in">log</span>(g.<span class="built_in">next</span>())</span><br><span class="line">// &lt;- &#123; done: <span class="literal">false</span>, value: <span class="number">2</span> &#125;</span><br><span class="line">console.<span class="built_in">log</span>(g.<span class="keyword">return</span>(<span class="number">6</span>))</span><br><span class="line">// &lt;- &#123; done: <span class="literal">false</span>, value: <span class="number">3</span> &#125;</span><br><span class="line">console.<span class="built_in">log</span>(g.<span class="built_in">next</span>())</span><br><span class="line">// &lt;- &#123; done: <span class="literal">false</span>, value: <span class="number">4</span> &#125;</span><br><span class="line">console.<span class="built_in">log</span>(g.<span class="built_in">next</span>())</span><br><span class="line">// &lt;- &#123; done: <span class="literal">true</span>, value: <span class="number">6</span> &#125;</span><br></pre></td></tr></table></figure>
<p>That’s all there is to know when it comes to generators <em>in terms of functionality.</em></p>
<h2 id="Use-Cases-for-ES6-Generators"><a href="#Use-Cases-for-ES6-Generators" class="headerlink" title="Use Cases for ES6 Generators"></a><a href="#use-cases-for-es6-generators">Use Cases for ES6 Generators</a></h2><p>At this point in the article you should feel comfortable with the concepts of iterators, iterables, and generators in ES6. If you feel like reading more on the subject, I highly recommend you go over <a href="http://www.2ality.com/2015/03/es6-generators.html" target="_blank" rel="noopener">Axel’s article on generators</a>, as he put together an amazing write-up on use cases for generators just <em>a few months ago</em>.</p>

      
    </div>
    
    
    

    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者：</strong>
    Frankl
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="www.lpldplws.cn/2018/08/01/pureMaterial/11.generators/" title="11.generators">www.lpldplws.cn/2018/08/01/pureMaterial/11.generators/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>
    本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/pure-material/" rel="tag"># pure material</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/08/01/leetCode/string/04.reverse_string/" rel="next" title="leetCode String -- 4.Reverse String">
                <i class="fa fa-chevron-left"></i> leetCode String -- 4.Reverse String
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/08/01/leetCode/string/05.reverse_words_in_a_string_III/" rel="prev" title="leetCode String -- 5.Reverse Words in a String III">
                leetCode String -- 5.Reverse Words in a String III <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread" style="display:block">
      
        <!--MOB SHARE BEGIN-->
 <div class="-mob-share-ui-button -mob-share-open" style="display:block;background: darkgrey;width: 20em;margin: 0 auto;">分享</div>
 <div class="-mob-share-ui" style="display: none">
     <ul class="-mob-share-list">
         <li class="-mob-share-weibo"><p>新浪微博</p></li>
         <li class="-mob-share-tencentweibo"><p>腾讯微博</p></li>
         <li class="-mob-share-qzone"><p>QQ空间</p></li>
         <li class="-mob-share-qq"><p>QQ好友</p></li>
         <li class="-mob-share-weixin"><p>微信</p></li>
         <li class="-mob-share-douban"><p>豆瓣</p></li>
         <li class="-mob-share-renren"><p>人人网</p></li>
         <li class="-mob-share-kaixin"><p>开心网</p></li>
         <li class="-mob-share-facebook"><p>Facebook</p></li>
         <li class="-mob-share-twitter"><p>Twitter</p></li>
         <li class="-mob-share-pocket"><p>Pocket</p></li>
         <li class="-mob-share-google"><p>Google+</p></li>
         <li class="-mob-share-youdao"><p>有道云笔记</p></li>
         <li class="-mob-share-mingdao"><p>明道</p></li>
         <li class="-mob-share-pengyou"><p>朋友网</p></li>
         <li class="-mob-share-tumblr"><p>Tumblr</p></li>
         <li class="-mob-share-instapaper"><p>Instapaper</p></li>
         <li class="-mob-share-linkedin"><p>LinkedIn</p></li>
     </ul>
     <div class="-mob-share-close">取消</div>
 </div>
 <div class="-mob-share-ui-bg"></div>
 <script id="-mob-share" src="http://f1.webshare.mob.com/code/mob-share.js?appkey=26afb7d19666e"></script>

      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="lv-container" data-id="city" data-uid="MTAyMC8zNzgxNy8xNDM0OA=="></div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/favicon.jpg"
                alt="Frankl" />
            
              <p class="site-author-name" itemprop="name">Frankl</p>
              <p class="site-description motion-element" itemprop="description">Base on front-end, more than front-end</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">86</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">8</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">8</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/lpldplws" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:qinhui@bupt.edu.cn" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-globe"></i>E-Mail</a>
                  </span>
                
            </div>
          
          
            <div class="music-container">
            </div>
			<script src="https://www.newraina.com/mePlayer/dist/meplayer.min.js"></script>
            <script>
            mePlayer({
				theme: '',
				music : {
                    src : '/lib/music/BestDaysofMyYouth.mp3',
					title : '尚好的青春',
					author: '孙燕姿',
					cover : 'http://www.lpldplws.cn/images/favicon.jpg',
					lrc   : '[00:02.04]尚好的青春\n[00:02.31]词: 潘协庆\n[00:03.12]曲: 郭文贤\n[00:03.91]演唱：孙燕姿\n[00:16.12]尚好的青春都是你\n[00:21.60]再遥远 都跟随你\n[00:28.68]若滂沱大雨\n[00:30.89]不曾见证\n[00:32.30]海角相偎依\n[00:35.43]衣角怎么会\n[00:38.87]湿淋淋\n[00:41.31]\n[00:42.78]尚好的青春都是你\n[00:48.37]没有片刻不想你\n[00:55.24]就算能真在对的时间\n[00:58.98]遇见对的你\n[01:02.08]遗失的青春怎能回得去\n[01:07.01]\n[01:08.80]千万记得天涯有人在等你\n[01:15.31]风 再疾再狂我也不放弃\n[01:21.74]愿为你\n[01:23.24]直到有一刻能守着你的心\n[01:28.27]就算你不会懂 也不会可惜\n[01:33.58]\n[01:35.31]千万记得天涯有人在等待\n[01:42.00]路程再多遥远不要不回来\n[01:48.29]不去想不去计量你的心\n[01:52.98]有多明白\n[01:54.94]前往幸福的路有多少阻碍\n[02:01.95]就算给你的爱\n[02:04.87]石沉大海\n[02:08.13]青春飞逝就再\n[02:11.41]找不回来\n[02:13.98]\n[02:27.89]尚好的青春都是你\n[02:33.16]没有片刻不想你\n[02:40.20]就算能真在对的时间\n[02:43.79]遇见对的你\n[02:46.84]遗失的青春怎能回得去\n[02:52.10]\n[02:53.75]千万记得天涯有人在等你\n[03:00.21]风 再疾再狂我也不放弃\n[03:06.40]愿为你\n[03:08.09]直到有一刻能守着你的心\n[03:13.04]就算你不会懂\n[03:15.68]也不会可惜\n[03:18.44]\n[03:20.37]千万记得天涯有人在等待\n[03:26.84]路程再多遥远不要不回来\n[03:33.14]不去想不去计量你的心有多明白\n[03:39.73]前往幸福的路有多少阻碍\n[03:47.02]就算给你的爱\n[03:49.81]石沉大海\n[03:53.48]青春飞逝就再\n[03:56.59]找不回来\n[03:59.37]'
				},
				target: '.music-container',
				autoplay: false 
			}); 
            </script>
          
          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://testudy.cc" title="胡继伟" target="_blank">胡继伟</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://github.com/cnsnake11/blog" title="曹楠" target="_blank">曹楠</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://github.com/shengoo/notes" title="生庆" target="_blank">生庆</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://github.com/jacky-jiang/blog/" title="蒋艺" target="_blank">蒋艺</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.apptranz.com/wk/" title="梁恺韬" target="_blank">梁恺韬</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.my358.cn" title="苗志高" target="_blank">苗志高</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://hushichao.github.io" title="胡世超" target="_blank">胡世超</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://lq1228.github.io/" title="李倩" target="_blank">李倩</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://lilywei739.github.io" title="魏莉" target="_blank">魏莉</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.jianshu.com/u/0dd57ee96426" title="于鹏" target="_blank">于鹏</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://juejin.im/user/59532c1c5188250d7a0b2bb7" title="王超健" target="_blank">王超健</a>
                  </li>
                
              </ul>
            </div>
          
          

        </div>

      
      <!--noindex-->
      </section>
      <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
        <div class="post-toc">

          
            
          

          
            <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#generators"><span class="nav-number">1.</span> <span class="nav-text">generators</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Generator-Functions-and-Generator-Objects"><span class="nav-number">2.</span> <span class="nav-text">Generator Functions and Generator Objects</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Iterating-Over-Generators-by-Hand"><span class="nav-number">3.</span> <span class="nav-text">Iterating Over Generators by Hand</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Generators-The-Weird-Awesome-Parts"><span class="nav-number">4.</span> <span class="nav-text">Generators: The Weird Awesome Parts</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Inversion-of-Control"><span class="nav-number">4.1.</span> <span class="nav-text">Inversion of Control</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Dealing-with-asynchronous-flows"><span class="nav-number">4.2.</span> <span class="nav-text">Dealing with asynchronous flows</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Throwing-at-a-Generator"><span class="nav-number">4.3.</span> <span class="nav-text">Throwing at a Generator</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Returning-on-Behalf-of-a-Generator"><span class="nav-number">4.4.</span> <span class="nav-text">Returning on Behalf of a Generator</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Use-Cases-for-ES6-Generators"><span class="nav-number">5.</span> <span class="nav-text">Use Cases for ES6 Generators</span></a></li></ol></div>
          

        </div>
      </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Frankl</span>

  
</div>



        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    
  	    <!-- custom analytics part create by xiamo -->
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
<script>AV.initialize("aUG4vd9Krriqy647ANRoSSer-gzGzoHsz", "kdMloa4KY0uLCvse71kG5F7x");</script>
<script>
function showTime(Counter) {
	var query = new AV.Query(Counter);
	$(".leancloud_visitors").each(function() {
		var url = $(this).attr("id").trim();
		query.equalTo("url", url);
		query.find({
			success: function(results) {
				if (results.length == 0) {
					var content = $(document.getElementById(url)).text() + ': 0';
					$(document.getElementById(url)).text(content);
					return;
				}
				for (var i = 0; i < results.length; i++) {
					var object = results[i];
					var content = $(document.getElementById(url)).text() + ': ' + object.get('time');
					$(document.getElementById(url)).text(content);
				}
			},
			error: function(object, error) {
				console.log("Error: " + error.code + " " + error.message);
			}
		});

	});
}

function addCount(Counter) {
	var Counter = AV.Object.extend("Counter");
	url = $(".leancloud_visitors").attr('id').trim();
	title = $(".leancloud_visitors").attr('data-flag-title').trim();
	var query = new AV.Query(Counter);
	query.equalTo("url", url);
	query.find({
		success: function(results) {
			if (results.length > 0) {
				var counter = results[0];
				counter.fetchWhenSave(true);
				counter.increment("time");
				counter.save(null, {
					success: function(counter) {
						var content = $(document.getElementById(url)).text() + ': ' + counter.get('time');
						$(document.getElementById(url)).text(content);
					},
					error: function(counter, error) {
						console.log('Failed to save Visitor num, with error message: ' + error.message);
					}
				});
			} else {
				var newcounter = new Counter();
				newcounter.set("title", title);
				newcounter.set("url", url);
				newcounter.set("time", 1);
				newcounter.save(null, {
					success: function(newcounter) {
					    console.log("newcounter.get('time')="+newcounter.get('time'));
						var content = $(document.getElementById(url)).text() + ': ' + newcounter.get('time');
						$(document.getElementById(url)).text(content);
					},
					error: function(newcounter, error) {
						console.log('Failed to create');
					}
				});
			}
		},
		error: function(error) {
			console.log('Error:' + error.code + " " + error.message);
		}
	});
}
$(function() {
	var Counter = AV.Object.extend("Counter");
	if ($('.leancloud_visitors').length == 1) {
		addCount(Counter);
	} else if ($('.post-title-link').length > 1) {
		showTime(Counter);
	}
});
</script>

      
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  






  
  







  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/three.min.js"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/canvas_lines.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  








  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("aUG4vd9Krriqy647ANRoSSer-gzGzoHsz", "kdMloa4KY0uLCvse71kG5F7x");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

</body>
</html>
