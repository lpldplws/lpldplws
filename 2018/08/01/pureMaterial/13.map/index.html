<!DOCTYPE html>



  


<html class="theme-next gemini use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">



  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-flash.min.css?v=1.0.2" rel="stylesheet">


    <link href="https://www.newraina.com/mePlayer/dist/meplayer.css" rel="stylesheet">
    <style>
        .meplayer-meta-time-tick {
            margin-top:10px !important;
        }
        .meplayer-control-play {
            right:-15px !important;
        }
        .meplayer-control-play .icon-pause {
            left:52% !important;
        }
        .meplayer-lyric {
            width: 150px !important;
            margin-left: -83px !important;
        }
    </style>






<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />



  <meta name="google-site-verification" content="eedHk7Al-RbPChTtgjvTm8V1dET0AGyXDzxnjDCXthU" />














  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  
    
      
    

    
  

  

  

  
    
      
    

    
  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic|Roboto Slab:300,300italic,400,400italic,700,700italic|PT Mono:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.jpg?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon.jpg?v=5.1.4">


  <link rel="mask-icon" href="/images/favicon.png?v=5.1.4" color="#222">





  <meta name="keywords" content="pure material," />










<meta name="description" content="mapBefore ES6, There Were Hash-MapsA very common _ab_use case of JavaScript objects is hash-maps, where we map string keys to arbitrary values. For example, one might use an object to map npm package">
<meta name="keywords" content="pure material">
<meta property="og:type" content="article">
<meta property="og:title" content="13.map">
<meta property="og:url" content="www.lpldplws.cn/2018/08/01/pureMaterial/13.map/index.html">
<meta property="og:site_name" content="Frankl&#39;s Personal Blog">
<meta property="og:description" content="mapBefore ES6, There Were Hash-MapsA very common _ab_use case of JavaScript objects is hash-maps, where we map string keys to arbitrary values. For example, one might use an object to map npm package">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2018-08-01T06:01:37.976Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="13.map">
<meta name="twitter:description" content="mapBefore ES6, There Were Hash-MapsA very common _ab_use case of JavaScript objects is hash-maps, where we map string keys to arbitrary values. For example, one might use an object to map npm package">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: 'undefined',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="www.lpldplws.cn/2018/08/01/pureMaterial/13.map/"/>





  <title>13.map | Frankl's Personal Blog</title>
  




<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
          m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-121839770-1', 'auto');
  ga('send', 'pageview');
</script>





</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  
  <img src='http://www.lpldplws.cn/images/favicon.jpg' style="display:none;"/>
  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Frankl's Personal Blog</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="www.lpldplws.cn/2018/08/01/pureMaterial/13.map/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Frankl">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/favicon.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Frankl's Personal Blog">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">13.map</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-01T17:58:47+08:00">
                2018-08-01
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/pure-material/" itemprop="url" rel="index">
                    <span itemprop="name">pure material</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2018/08/01/pureMaterial/13.map/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count fb-comments-count" data-href="www.lpldplws.cn/2018/08/01/pureMaterial/13.map/" itemprop="commentCount">0</span> comments
                </a>
              </span>
            
          

          
          
             <span id="/2018/08/01/pureMaterial/13.map/" class="leancloud_visitors" data-flag-title="13.map">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="map"><a href="#map" class="headerlink" title="map"></a>map</h2><h1 id="Before-ES6-There-Were-Hash-Maps"><a href="#Before-ES6-There-Were-Hash-Maps" class="headerlink" title="Before ES6, There Were Hash-Maps"></a><a href="#before-es6-there-were-hash-maps">Before ES6, There Were Hash-Maps</a></h1><p>A very common _ab_use case of JavaScript objects is hash-maps, where we map string keys to arbitrary values. For example, one might use an object to map <code>npm</code> package names to their metadata, like so:</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">var registry = &#123;&#125;</span><br><span class="line">function <span class="keyword">add</span><span class="bash"> (name, meta) &#123;</span></span><br><span class="line"><span class="bash">  registry[name] = meta</span></span><br><span class="line"><span class="bash">&#125;</span></span><br><span class="line"><span class="bash"><span class="keyword">function</span> get (name) &#123;</span></span><br><span class="line"><span class="bash">  <span class="built_in">return</span> registry[name]</span></span><br><span class="line"><span class="bash">&#125;</span></span><br><span class="line"><span class="bash">add(<span class="string">'contra'</span>, &#123; description: <span class="string">'Asynchronous flow control'</span> &#125;)</span></span><br><span class="line"><span class="bash">add(<span class="string">'dragula'</span>, &#123; description: <span class="string">'Drag and drop'</span> &#125;)</span></span><br><span class="line"><span class="bash">add(<span class="string">'woofmark'</span>, &#123; description: <span class="string">'Markdown and WYSIWYG editor'</span> &#125;)</span></span><br></pre></td></tr></table></figure>
<p>There’s several issues with this approach, to wit:</p>
<ul>
<li><strong>Security issues</strong> where user-provided keys like <code>__proto__</code>, <code>toString</code>, or anything in <code>Object.prototype</code> break expectations and make interaction with these kinds of <em>hash-map</em> data structures more cumbersome</li>
<li>Iteration over list items is verbose with <code>Object.keys(registry).forEach</code> or implementing the <a href="/articles/es6-iterators-in-depth"><em>iterable</em> protocol</a> on the <code>registry</code></li>
<li>Keys are limited to strings, making it hard to create hash-maps where you’d like to index values by DOM elements or other non-string references</li>
</ul>
<p>The first problem could be fixed using a prefix, and being careful to always get or set values in the hash-map through methods. It would be even better to use <a href="https://developer.mozilla.org/en/docs/Web/JavaScript/Reference/Global_Objects/Proxy" target="_blank" rel="noopener">ES6 proxies</a>, but we <em>won’t be covering those until tomorrow!</em></p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">var registry = &#123;&#125;</span><br><span class="line">function <span class="keyword">add</span><span class="bash"> (name, meta) &#123;</span></span><br><span class="line"><span class="bash">  registry[<span class="string">'map:'</span> + name] = meta</span></span><br><span class="line"><span class="bash">&#125;</span></span><br><span class="line"><span class="bash"><span class="keyword">function</span> get (name) &#123;</span></span><br><span class="line"><span class="bash">  <span class="built_in">return</span> registry[<span class="string">'map:'</span> + name]</span></span><br><span class="line"><span class="bash">&#125;</span></span><br><span class="line"><span class="bash">add(<span class="string">'contra'</span>, &#123; description: <span class="string">'Asynchronous flow control'</span> &#125;)</span></span><br><span class="line"><span class="bash">add(<span class="string">'dragula'</span>, &#123; description: <span class="string">'Drag and drop'</span> &#125;)</span></span><br><span class="line"><span class="bash">add(<span class="string">'woofmark'</span>, &#123; description: <span class="string">'Markdown and WYSIWYG editor'</span> &#125;)</span></span><br></pre></td></tr></table></figure>
<p>Luckily for us, though, <em>ES6 maps</em> provide us with an even better solution to the key-naming security issue. At the same time they facilitate collection behaviors out the box that may also come in handy. Let’s plunge into their practical usage and inner workings.</p>
<h1 id="ES6-Maps"><a href="#ES6-Maps" class="headerlink" title="ES6 Maps"></a><a href="#es6-maps">ES6 Maps</a></h1><p>Map is a key/value data structure in ES6. It provides a better data structure to be used for hash-maps. Here’s how what we had earlier looks like with ES6 maps.</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">var</span> <span class="built_in">map</span> = <span class="literal">new</span> <span class="built_in">Map</span>()</span><br><span class="line"><span class="built_in">map</span>.<span class="built_in">set</span>(<span class="string">'contra'</span>, &#123; description: <span class="string">'Asynchronous flow control'</span> &#125;)</span><br><span class="line"><span class="built_in">map</span>.<span class="built_in">set</span>(<span class="string">'dragula'</span>, &#123; description: <span class="string">'Drag and drop'</span> &#125;)</span><br><span class="line"><span class="built_in">map</span>.<span class="built_in">set</span>(<span class="string">'woofmark'</span>, &#123; description: <span class="string">'Markdown and WYSIWYG editor'</span> &#125;)</span><br></pre></td></tr></table></figure>
<p>One of the important differences is also that you’re able to use anything for the keys. You’re not just limited to primitive values like symbols, numbers, or strings, but you can even use functions, objects and dates – too. Keys won’t be casted to strings like with regular objects, either.</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">var</span> <span class="built_in">map</span> = <span class="literal">new</span> <span class="built_in">Map</span>()</span><br><span class="line"><span class="built_in">map</span>.<span class="built_in">set</span>(<span class="literal">new</span> <span class="built_in">Date</span>(), function today () &#123;&#125;)</span><br><span class="line"><span class="built_in">map</span>.<span class="built_in">set</span>(() =&gt; <span class="string">'key'</span>, &#123; pony: <span class="string">'foo'</span> &#125;)</span><br><span class="line"><span class="built_in">map</span>.<span class="built_in">set</span>(Symbol(<span class="string">'items'</span>), <span class="meta">[</span><span class="number">1</span>, <span class="number">2</span><span class="meta">]</span>)</span><br></pre></td></tr></table></figure>
<p>You can also provide <code>Map</code> objects with any object that follows the <a href="/articles/es6-iterators-in-depth"><em>iterable</em> protocol</a> and produces a collection such as <code>[[&#39;key&#39;, &#39;value&#39;], [&#39;key&#39;, &#39;value&#39;]]</code>.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>([</span><br><span class="line">  [<span class="keyword">new</span> <span class="built_in">Date</span>(), <span class="function"><span class="keyword">function</span> <span class="title">today</span> (<span class="params"></span>) </span>&#123;&#125;],</span><br><span class="line">  [<span class="function"><span class="params">()</span> =&gt;</span> <span class="string">'key'</span>, &#123; <span class="attr">pony</span>: <span class="string">'foo'</span> &#125;],</span><br><span class="line">  [<span class="built_in">Symbol</span>(<span class="string">'items'</span>), [<span class="number">1</span>, <span class="number">2</span>]]</span><br><span class="line">])</span><br></pre></td></tr></table></figure>
<p>The above would be effectively the same as the following. Note how we’re using destructuring in the parameters of <code>items.forEach</code> to <em>effortlessly</em> pull the <code>key</code> and <code>value</code> out of the two-dimensional <code>item</code>.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> items = [</span><br><span class="line">  [<span class="keyword">new</span> <span class="built_in">Date</span>(), <span class="function"><span class="keyword">function</span> <span class="title">today</span> (<span class="params"></span>) </span>&#123;&#125;],</span><br><span class="line">  [<span class="function"><span class="params">()</span> =&gt;</span> <span class="string">'key'</span>, &#123; <span class="attr">pony</span>: <span class="string">'foo'</span> &#125;],</span><br><span class="line">  [<span class="built_in">Symbol</span>(<span class="string">'items'</span>), [<span class="number">1</span>, <span class="number">2</span>]]</span><br><span class="line">]</span><br><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>()</span><br><span class="line">items.forEach(<span class="function">(<span class="params">[key, value]</span>) =&gt;</span> map.set(key, value))</span><br></pre></td></tr></table></figure>
<p>Of course, it’s kind of silly to go through the trouble of adding items one by one when you can just feed an iterable to your <code>Map</code>. Speaking of iterables – <code>Map</code> adheres to the <a href="/articles/es6-iterators-in-depth"><em>iterable</em></a> protocol. It’s very easy to pull a key-value pair collection much like the ones you can feed to the <code>Map</code> constructor.</p>
<p>Naturally, we can use the spread operator to this effect.</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">var</span> <span class="built_in">map</span> = <span class="literal">new</span> <span class="built_in">Map</span>()</span><br><span class="line"><span class="built_in">map</span>.<span class="built_in">set</span>(<span class="string">'p'</span>, <span class="string">'o'</span>)</span><br><span class="line"><span class="built_in">map</span>.<span class="built_in">set</span>(<span class="string">'n'</span>, <span class="string">'y'</span>)</span><br><span class="line"><span class="built_in">map</span>.<span class="built_in">set</span>(<span class="string">'f'</span>, <span class="string">'o'</span>)</span><br><span class="line"><span class="built_in">map</span>.<span class="built_in">set</span>(<span class="string">'o'</span>, <span class="string">'!'</span>)</span><br><span class="line">console.<span class="keyword">log</span>(<span class="meta">[</span><span class="params">...</span><span class="built_in">map</span><span class="meta">]</span>)</span><br><span class="line">// &lt;- <span class="meta">[</span><span class="meta">[</span><span class="string">'p'</span>, <span class="string">'o'</span><span class="meta">]</span>, <span class="meta">[</span><span class="string">'n'</span>, <span class="string">'y'</span><span class="meta">]</span>, <span class="meta">[</span><span class="string">'f'</span>, <span class="string">'o'</span><span class="meta">]</span>, <span class="meta">[</span><span class="string">'o'</span>, <span class="string">'!'</span><span class="meta">]</span>]</span><br></pre></td></tr></table></figure>
<p>You could also use a <code>for..of</code> loop, and we could combine that with <a href="/articles/es6-destructuring-in-depth">destructuring</a> to make it seriously terse. Also, remember <a href="/articles/es6-template-strings-in-depth">template literals</a>?</p>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">var <span class="built_in">map</span> = <span class="keyword">new</span> Map()</span><br><span class="line"><span class="built_in">map</span>.<span class="built_in">set</span>(<span class="string">'p'</span>, <span class="string">'o'</span>)</span><br><span class="line"><span class="built_in">map</span>.<span class="built_in">set</span>(<span class="string">'n'</span>, <span class="string">'y'</span>)</span><br><span class="line"><span class="built_in">map</span>.<span class="built_in">set</span>(<span class="string">'f'</span>, <span class="string">'o'</span>)</span><br><span class="line"><span class="built_in">map</span>.<span class="built_in">set</span>(<span class="string">'o'</span>, <span class="string">'!'</span>)</span><br><span class="line"><span class="keyword">for</span> (let [<span class="built_in">key</span>, value] of <span class="built_in">map</span>) &#123;</span><br><span class="line">  console.<span class="built_in">log</span>(`$&#123;<span class="built_in">key</span>&#125;: $&#123;value&#125;`)</span><br><span class="line">  <span class="comment">// &lt;- 'p: o'</span></span><br><span class="line">  <span class="comment">// &lt;- 'n: y'</span></span><br><span class="line">  <span class="comment">// &lt;- 'f: o'</span></span><br><span class="line">  <span class="comment">// &lt;- 'o: !'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Even though maps have a programmatic API to add items, keys are unique, just like with hash-maps. Setting a key over and over again will only overwrite its value.</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">var</span> <span class="built_in">map</span> = <span class="literal">new</span> <span class="built_in">Map</span>()</span><br><span class="line"><span class="built_in">map</span>.<span class="built_in">set</span>(<span class="string">'a'</span>, <span class="string">'a'</span>)</span><br><span class="line"><span class="built_in">map</span>.<span class="built_in">set</span>(<span class="string">'a'</span>, <span class="string">'b'</span>)</span><br><span class="line"><span class="built_in">map</span>.<span class="built_in">set</span>(<span class="string">'a'</span>, <span class="string">'c'</span>)</span><br><span class="line">console.<span class="keyword">log</span>(<span class="meta">[</span><span class="params">...</span><span class="built_in">map</span><span class="meta">]</span>)</span><br><span class="line">// &lt;- <span class="meta">[</span><span class="meta">[</span><span class="string">'a'</span>, <span class="string">'c'</span><span class="meta">]</span>]</span><br></pre></td></tr></table></figure>
<p>In ES6 <code>Map</code>, <code>NaN</code> becomes a “corner-case” that gets <strong>treated as a value that’s equal to itself</strong> even though the following expression actually evaluates to <code>true</code> – <code>NaN !== NaN</code>.</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">console.<span class="keyword">log</span>(<span class="number">NaN</span> === <span class="number">NaN</span>)</span><br><span class="line"><span class="comment">// &lt;- false</span></span><br><span class="line"><span class="built_in">var</span> <span class="built_in">map</span> = <span class="literal">new</span> <span class="built_in">Map</span>()</span><br><span class="line"><span class="built_in">map</span>.<span class="built_in">set</span>(<span class="number">NaN</span>, <span class="string">'foo'</span>)</span><br><span class="line"><span class="built_in">map</span>.<span class="built_in">set</span>(<span class="number">NaN</span>, <span class="string">'bar'</span>)</span><br><span class="line">console.<span class="keyword">log</span>(<span class="meta">[</span><span class="params">...</span><span class="built_in">map</span><span class="meta">]</span>)</span><br><span class="line">// &lt;- <span class="meta">[</span><span class="meta">[</span><span class="number">NaN</span>, <span class="string">'bar'</span><span class="meta">]</span>]</span><br></pre></td></tr></table></figure>
<h2 id="Hash-Maps-and-the-DOM"><a href="#Hash-Maps-and-the-DOM" class="headerlink" title="Hash-Maps and the DOM"></a><a href="#hash-maps-and-the-dom">Hash-Maps and the DOM</a></h2><p>In ES5, whenever we had a DOM element we wanted to associate with an API object for some library, we had to follow a verbose and slow pattern like the one below. The following piece of code just returns an API object with a bunch of methods for a given DOM element, allowing us to put and remove DOM elements from the cache, and also allowing us to retrieve the API object for a DOM element – if one already exists.</p>
<figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">var cache = []</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">put</span> <span class="params">(el, api)</span> &#123;</span></span><br><span class="line">  cache.push(&#123; el: el, api: api &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">find</span> <span class="params">(el)</span> &#123;</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="built_in">i</span> = <span class="number">0</span>; <span class="built_in">i</span> &lt; cache.<span class="built_in">length</span>; <span class="built_in">i</span>++) &#123;</span><br><span class="line">    if (cache[i].el === el) &#123;</span><br><span class="line">      return cache[i].api</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">destroy</span> <span class="params">(el)</span> &#123;</span></span><br><span class="line">  <span class="keyword">for</span> (<span class="built_in">i</span> = <span class="number">0</span>; <span class="built_in">i</span> &lt; cache.<span class="built_in">length</span>; <span class="built_in">i</span>++) &#123;</span><br><span class="line">    if (cache[i].el === el) &#123;</span><br><span class="line">      cache.splice(i, <span class="number">1</span>)</span><br><span class="line">      return</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">thing</span> <span class="params">(el)</span> &#123;</span></span><br><span class="line">  var api = <span class="built_in">find</span>(el)</span><br><span class="line">  <span class="keyword">if</span> (api) &#123;</span><br><span class="line">    return api</span><br><span class="line">  &#125;</span><br><span class="line">  api = &#123;</span><br><span class="line">    method: method,</span><br><span class="line">    method2: method2,</span><br><span class="line">    method3: method3,</span><br><span class="line">    destroy: destroy.bind(null, el)</span><br><span class="line">  &#125;</span><br><span class="line">  put(el, api)</span><br><span class="line">  <span class="keyword">return</span> api</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>One of the coolest aspects of <code>Map</code>, <em>as I’ve previously mentioned</em>, is the ability to index by DOM elements. The fact that <code>Map</code> also has collection manipulation abilities also greatly simplifies things.</p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">var cache = <span class="keyword">new</span> Map()</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">put</span> <span class="params">(el, api)</span> &#123;</span></span><br><span class="line">  cache.<span class="keyword">set</span>(<span class="keyword">el</span>, api)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">find</span> <span class="params">(el)</span> &#123;</span></span><br><span class="line">  <span class="keyword">return</span> cache.<span class="built_in">get</span>(<span class="keyword">el</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">destroy</span> <span class="params">(el)</span> &#123;</span></span><br><span class="line">  cache.<span class="keyword">delete</span>(<span class="keyword">el</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">thing</span> <span class="params">(el)</span> &#123;</span></span><br><span class="line">  var api = <span class="keyword">find</span>(<span class="keyword">el</span>)</span><br><span class="line">  <span class="keyword">if</span> (api) &#123;</span><br><span class="line">    <span class="keyword">return</span> api</span><br><span class="line">  &#125;</span><br><span class="line">  api = &#123;</span><br><span class="line">    method: method,</span><br><span class="line">    method2: method2,</span><br><span class="line">    method3: method3,</span><br><span class="line">    destroy: destroy.bind(null, <span class="keyword">el</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">put</span>(<span class="keyword">el</span>, api)</span><br><span class="line">  <span class="keyword">return</span> api</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The fact that these methods have now become one liners means we can just inline them, as readability is no longer an issue. We just went from <em>~30 LOC</em> to <strong>half that amount</strong>. Needless to say, at some point in the future this will also perform <em>much</em> faster than the haystack alternative.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> cache = <span class="keyword">new</span> <span class="built_in">Map</span>()</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">thing</span> (<span class="params">el</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> api = cache.get(el)</span><br><span class="line">  <span class="keyword">if</span> (api) &#123;</span><br><span class="line">    <span class="keyword">return</span> api</span><br><span class="line">  &#125;</span><br><span class="line">  api = &#123;</span><br><span class="line">    method: method,</span><br><span class="line">    method2: method2,</span><br><span class="line">    method3: method3,</span><br><span class="line">    destroy: <span class="function"><span class="params">()</span> =&gt;</span> cache.delete(el)</span><br><span class="line">  &#125;</span><br><span class="line">  cache.set(el, api)</span><br><span class="line">  <span class="keyword">return</span> api</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>The simplicity of <code>Map</code> is amazing. If you ask me, we desperately needed this feature in JavaScript. Being to index a collection by arbitrary objects is <strong>super important</strong>.</p>
<blockquote>
<p>What else can we do with <code>Map</code>?</p>
</blockquote>
<h2 id="Collection-Methods-in-Map"><a href="#Collection-Methods-in-Map" class="headerlink" title="Collection Methods in Map"></a><a href="#collection-methods-in-map">Collection Methods in <code>Map</code></a></h2><p>Maps make it very easy to probe the collection and figure out whether a <code>key</code> is defined in the <code>Map</code>. As we noted earlier, <code>NaN</code> equals <code>NaN</code> as far as <code>Map</code> is concerned. However, <code>Symbol</code> values are always different, so you’ll have to use them by value!</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>([[<span class="literal">NaN</span>, <span class="number">1</span>], [<span class="built_in">Symbol</span>(), <span class="number">2</span>], [<span class="string">'foo'</span>, <span class="string">'bar'</span>]])</span><br><span class="line"><span class="built_in">console</span>.log(map.has(<span class="literal">NaN</span>))</span><br><span class="line"><span class="comment">// &lt;- true</span></span><br><span class="line"><span class="built_in">console</span>.log(map.has(<span class="built_in">Symbol</span>()))</span><br><span class="line"><span class="comment">// &lt;- false</span></span><br><span class="line"><span class="built_in">console</span>.log(map.has(<span class="string">'foo'</span>))</span><br><span class="line"><span class="comment">// &lt;- true</span></span><br><span class="line"><span class="built_in">console</span>.log(map.has(<span class="string">'bar'</span>))</span><br><span class="line"><span class="comment">// &lt;- false</span></span><br></pre></td></tr></table></figure>
<p>As long as you keep a <code>Symbol</code> reference around, you’ll be okay. <em>Keep your references close, and your <code>Symbol</code>s closer?</em></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sym = <span class="built_in">Symbol</span>()</span><br><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>([[<span class="literal">NaN</span>, <span class="number">1</span>], [sym, <span class="number">2</span>], [<span class="string">'foo'</span>, <span class="string">'bar'</span>]])</span><br><span class="line"><span class="built_in">console</span>.log(map.has(sym))</span><br><span class="line"><span class="comment">// &lt;- true</span></span><br></pre></td></tr></table></figure>
<p>Also, remember the <strong>no key-casting</strong> thing? <em>Beware!</em> We are so used to objects casting keys to strings that this may bite you if you’re not careful.</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var <span class="built_in">map</span> = <span class="keyword">new</span> Map([[<span class="number">1</span>, <span class="string">'a'</span>]])</span><br><span class="line">console.<span class="built_in">log</span>(<span class="built_in">map</span>.has(<span class="number">1</span>))</span><br><span class="line"><span class="comment">// &lt;- true</span></span><br><span class="line">console.<span class="built_in">log</span>(<span class="built_in">map</span>.has(<span class="string">'1'</span>))</span><br><span class="line"><span class="comment">// &lt;- false</span></span><br></pre></td></tr></table></figure>
<p>You can also clear a <code>Map</code> entirely of entries without losing a reference to it. This can be very handy sometimes.</p>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">var <span class="built_in">map</span> = <span class="keyword">new</span> Map([[<span class="number">1</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">4</span>], [<span class="number">5</span>, <span class="number">6</span>]])</span><br><span class="line"><span class="built_in">map</span>.<span class="built_in">clear</span>()</span><br><span class="line">console.<span class="built_in">log</span>(<span class="built_in">map</span>.has(<span class="number">1</span>))</span><br><span class="line"><span class="comment">// &lt;- false</span></span><br><span class="line">console.<span class="built_in">log</span>([...<span class="built_in">map</span>])</span><br><span class="line"><span class="comment">// &lt;- []</span></span><br></pre></td></tr></table></figure>
<p>When you use <code>Map</code> as an iterable, you are actually looping over its <code>.entries()</code>. That means that you don’t need to <strong>explicitly</strong> iterate over <code>.entries()</code>. It’ll be done on your behalf anyways. You do remember <a href="/articles/es6-iterators-in-depth"><code>Symbol.iterator</code></a>, right?</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">console.<span class="built_in">log</span>(<span class="built_in">map</span>[Symbol.iterator] === <span class="built_in">map</span>.entries)</span><br><span class="line"><span class="comment">// &lt;- true</span></span><br></pre></td></tr></table></figure>
<p>Just like <code>.entries()</code>, <code>Map</code> has two other iterators you can leverage. These are <code>.keys()</code> and <code>.values()</code>. I’m sure you guessed what sequences of values they yield, but here’s a code snippet anyways.</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">var</span> map = new Map([[<span class="number">1</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">4</span>], [<span class="number">5</span>, <span class="number">6</span>]])</span><br><span class="line">console.log([..<span class="selector-class">.map</span><span class="selector-class">.keys</span>()])</span><br><span class="line"><span class="comment">// &lt;- [1, 3, 5]</span></span><br><span class="line">console.log([..<span class="selector-class">.map</span><span class="selector-class">.values</span>()])</span><br><span class="line"><span class="comment">// &lt;- [2, 4, 6]</span></span><br></pre></td></tr></table></figure>
<p>Maps also come with a <em>read-only</em> <code>.size</code> property that behaves sort of like <code>Array.prototype.length</code> – at any point in time it gives you the current amount of entries in the map.</p>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">var <span class="built_in">map</span> = <span class="keyword">new</span> Map([[<span class="number">1</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">4</span>], [<span class="number">5</span>, <span class="number">6</span>]])</span><br><span class="line">console.<span class="built_in">log</span>(<span class="built_in">map</span>.<span class="built_in">size</span>)</span><br><span class="line"><span class="comment">// &lt;- 3</span></span><br><span class="line"><span class="built_in">map</span>.delete(<span class="number">3</span>)</span><br><span class="line">console.<span class="built_in">log</span>(<span class="built_in">map</span>.<span class="built_in">size</span>)</span><br><span class="line"><span class="comment">// &lt;- 2</span></span><br><span class="line"><span class="built_in">map</span>.<span class="built_in">clear</span>()</span><br><span class="line">console.<span class="built_in">log</span>(<span class="built_in">map</span>.<span class="built_in">size</span>)</span><br><span class="line"><span class="comment">// &lt;- 0</span></span><br></pre></td></tr></table></figure>
<p>One more aspect of <code>Map</code> that’s worth mentioning is that their entries are always iterated in <strong>insertion order</strong>. This is in contrast with <code>Object.keys</code> loops which follow <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/for...in" target="_blank" rel="noopener">an arbitrary order</a>.</p>
<blockquote>
<p>The <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Statements/for...in" target="_blank" rel="noopener"><code>for..in</code></a> statement iterates over the enumerable properties of an object, in arbitrary order.</p>
</blockquote>
<p>Maps also have a <code>.forEach</code> method that’s identical in <em>behavior</em> to that in ES5 <code>Array</code> objects. Once again, keys do not get casted into strings here.</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> map = <span class="keyword">new</span> <span class="built_in">Map</span>([[<span class="literal">NaN</span>, <span class="number">1</span>], [<span class="built_in">Symbol</span>(), <span class="number">2</span>], [<span class="string">'foo'</span>, <span class="string">'bar'</span>]])</span><br><span class="line">map.forEach(<span class="function">(<span class="params">value, key</span>) =&gt;</span> <span class="built_in">console</span>.log(key, value))</span><br><span class="line"><span class="comment">// &lt;- NaN 1</span></span><br><span class="line"><span class="comment">// &lt;- Symbol() 2</span></span><br><span class="line"><span class="comment">// &lt;- 'foo' 'bar'</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>Get up early tomorrow morning, we’ll be having <a href="http://ponyfoo.com/articles/es6-weakmaps-sets-and-weaksets-in-depth" target="_blank" rel="noopener"><code>WeakMap</code>, <code>Set</code>, and <code>WeakSet</code></a> for breakfast :)</p>
</blockquote>

      
    </div>
    
    
    

    

    

    
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者：</strong>
    Frankl
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="www.lpldplws.cn/2018/08/01/pureMaterial/13.map/" title="13.map">www.lpldplws.cn/2018/08/01/pureMaterial/13.map/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>
    本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/3.0/" rel="external nofollow" target="_blank">CC BY-NC-SA 3.0</a> 许可协议。转载请注明出处！
  </li>
</ul>

      </div>
    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/pure-material/" rel="tag"># pure material</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/08/01/leetCode/string/07.longest_uncommon_subsequence_I/" rel="next" title="leetCode String -- 7.Longest Uncommon Subsequence I">
                <i class="fa fa-chevron-left"></i> leetCode String -- 7.Longest Uncommon Subsequence I
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/08/01/pureMaterial/14.weakMaps/" rel="prev" title="14.weakmap">
                14.weakmap <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread" style="display:block">
      
        <!--MOB SHARE BEGIN-->
 <div class="-mob-share-ui-button -mob-share-open" style="display:block;background: darkgrey;width: 20em;margin: 0 auto;">分享</div>
 <div class="-mob-share-ui" style="display: none">
     <ul class="-mob-share-list">
         <li class="-mob-share-weibo"><p>新浪微博</p></li>
         <li class="-mob-share-tencentweibo"><p>腾讯微博</p></li>
         <li class="-mob-share-qzone"><p>QQ空间</p></li>
         <li class="-mob-share-qq"><p>QQ好友</p></li>
         <li class="-mob-share-weixin"><p>微信</p></li>
         <li class="-mob-share-douban"><p>豆瓣</p></li>
         <li class="-mob-share-renren"><p>人人网</p></li>
         <li class="-mob-share-kaixin"><p>开心网</p></li>
         <li class="-mob-share-facebook"><p>Facebook</p></li>
         <li class="-mob-share-twitter"><p>Twitter</p></li>
         <li class="-mob-share-pocket"><p>Pocket</p></li>
         <li class="-mob-share-google"><p>Google+</p></li>
         <li class="-mob-share-youdao"><p>有道云笔记</p></li>
         <li class="-mob-share-mingdao"><p>明道</p></li>
         <li class="-mob-share-pengyou"><p>朋友网</p></li>
         <li class="-mob-share-tumblr"><p>Tumblr</p></li>
         <li class="-mob-share-instapaper"><p>Instapaper</p></li>
         <li class="-mob-share-linkedin"><p>LinkedIn</p></li>
     </ul>
     <div class="-mob-share-close">取消</div>
 </div>
 <div class="-mob-share-ui-bg"></div>
 <script id="-mob-share" src="http://f1.webshare.mob.com/code/mob-share.js?appkey=26afb7d19666e"></script>

      
    </div>
  </div>


          </div>
          


          

  
    <div class="comments" id="comments">
      <div id="lv-container" data-id="city" data-uid="MTAyMC8zNzgxNy8xNDM0OA=="></div>
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/favicon.jpg"
                alt="Frankl" />
            
              <p class="site-author-name" itemprop="name">Frankl</p>
              <p class="site-description motion-element" itemprop="description">Base on front-end, more than front-end</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives">
              
                  <span class="site-state-item-count">79</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">8</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">8</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          

          
            <div class="links-of-author motion-element">
                
                  <span class="links-of-author-item">
                    <a href="https://github.com/lpldplws" target="_blank" title="GitHub">
                      
                        <i class="fa fa-fw fa-github"></i>GitHub</a>
                  </span>
                
                  <span class="links-of-author-item">
                    <a href="mailto:qinhui@bupt.edu.cn" target="_blank" title="E-Mail">
                      
                        <i class="fa fa-fw fa-globe"></i>E-Mail</a>
                  </span>
                
            </div>
          
          
            <div class="music-container">
            </div>
			<script src="https://www.newraina.com/mePlayer/dist/meplayer.min.js"></script>
            <script>
            mePlayer({
				theme: '',
				music : {
                    src : '/lib/music/BestDaysofMyYouth.mp3',
					title : '尚好的青春',
					author: '孙燕姿',
					cover : 'http://www.lpldplws.cn/images/favicon.jpg',
					lrc   : '[00:02.04]尚好的青春\n[00:02.31]词: 潘协庆\n[00:03.12]曲: 郭文贤\n[00:03.91]演唱：孙燕姿\n[00:16.12]尚好的青春都是你\n[00:21.60]再遥远 都跟随你\n[00:28.68]若滂沱大雨\n[00:30.89]不曾见证\n[00:32.30]海角相偎依\n[00:35.43]衣角怎么会\n[00:38.87]湿淋淋\n[00:41.31]\n[00:42.78]尚好的青春都是你\n[00:48.37]没有片刻不想你\n[00:55.24]就算能真在对的时间\n[00:58.98]遇见对的你\n[01:02.08]遗失的青春怎能回得去\n[01:07.01]\n[01:08.80]千万记得天涯有人在等你\n[01:15.31]风 再疾再狂我也不放弃\n[01:21.74]愿为你\n[01:23.24]直到有一刻能守着你的心\n[01:28.27]就算你不会懂 也不会可惜\n[01:33.58]\n[01:35.31]千万记得天涯有人在等待\n[01:42.00]路程再多遥远不要不回来\n[01:48.29]不去想不去计量你的心\n[01:52.98]有多明白\n[01:54.94]前往幸福的路有多少阻碍\n[02:01.95]就算给你的爱\n[02:04.87]石沉大海\n[02:08.13]青春飞逝就再\n[02:11.41]找不回来\n[02:13.98]\n[02:27.89]尚好的青春都是你\n[02:33.16]没有片刻不想你\n[02:40.20]就算能真在对的时间\n[02:43.79]遇见对的你\n[02:46.84]遗失的青春怎能回得去\n[02:52.10]\n[02:53.75]千万记得天涯有人在等你\n[03:00.21]风 再疾再狂我也不放弃\n[03:06.40]愿为你\n[03:08.09]直到有一刻能守着你的心\n[03:13.04]就算你不会懂\n[03:15.68]也不会可惜\n[03:18.44]\n[03:20.37]千万记得天涯有人在等待\n[03:26.84]路程再多遥远不要不回来\n[03:33.14]不去想不去计量你的心有多明白\n[03:39.73]前往幸福的路有多少阻碍\n[03:47.02]就算给你的爱\n[03:49.81]石沉大海\n[03:53.48]青春飞逝就再\n[03:56.59]找不回来\n[03:59.37]'
				},
				target: '.music-container',
				autoplay: false 
			}); 
            </script>
          
          
          

          
          
            <div class="links-of-blogroll motion-element links-of-blogroll-block">
              <div class="links-of-blogroll-title">
                <i class="fa  fa-fw fa-link"></i>
                Links
              </div>
              <ul class="links-of-blogroll-list">
                
                  <li class="links-of-blogroll-item">
                    <a href="https://testudy.cc" title="胡继伟" target="_blank">胡继伟</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://github.com/cnsnake11/blog" title="曹楠" target="_blank">曹楠</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://github.com/shengoo/notes" title="生庆" target="_blank">生庆</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://github.com/jacky-jiang/blog/" title="蒋艺" target="_blank">蒋艺</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.apptranz.com/wk/" title="梁恺韬" target="_blank">梁恺韬</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="http://www.my358.cn" title="苗志高" target="_blank">苗志高</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://hushichao.github.io" title="胡世超" target="_blank">胡世超</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://lq1228.github.io/" title="李倩" target="_blank">李倩</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://lilywei739.github.io" title="魏莉" target="_blank">魏莉</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://www.jianshu.com/u/0dd57ee96426" title="于鹏" target="_blank">于鹏</a>
                  </li>
                
                  <li class="links-of-blogroll-item">
                    <a href="https://juejin.im/user/59532c1c5188250d7a0b2bb7" title="王超健" target="_blank">王超健</a>
                  </li>
                
              </ul>
            </div>
          
          

        </div>

      
      <!--noindex-->
      </section>
      <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
        <div class="post-toc">

          
            
          

          
            <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#map"><span class="nav-number">1.</span> <span class="nav-text">map</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Before-ES6-There-Were-Hash-Maps"><span class="nav-number"></span> <span class="nav-text">Before ES6, There Were Hash-Maps</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#ES6-Maps"><span class="nav-number"></span> <span class="nav-text">ES6 Maps</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Hash-Maps-and-the-DOM"><span class="nav-number">1.</span> <span class="nav-text">Hash-Maps and the DOM</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Collection-Methods-in-Map"><span class="nav-number">2.</span> <span class="nav-text">Collection Methods in Map</span></a></li></ol></div>
          

        </div>
      </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Frankl</span>

  
</div>



        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    
  	    <!-- custom analytics part create by xiamo -->
<script src="https://cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script>
<script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
<script>AV.initialize("aUG4vd9Krriqy647ANRoSSer-gzGzoHsz", "kdMloa4KY0uLCvse71kG5F7x");</script>
<script>
function showTime(Counter) {
	var query = new AV.Query(Counter);
	$(".leancloud_visitors").each(function() {
		var url = $(this).attr("id").trim();
		query.equalTo("url", url);
		query.find({
			success: function(results) {
				if (results.length == 0) {
					var content = $(document.getElementById(url)).text() + ': 0';
					$(document.getElementById(url)).text(content);
					return;
				}
				for (var i = 0; i < results.length; i++) {
					var object = results[i];
					var content = $(document.getElementById(url)).text() + ': ' + object.get('time');
					$(document.getElementById(url)).text(content);
				}
			},
			error: function(object, error) {
				console.log("Error: " + error.code + " " + error.message);
			}
		});

	});
}

function addCount(Counter) {
	var Counter = AV.Object.extend("Counter");
	url = $(".leancloud_visitors").attr('id').trim();
	title = $(".leancloud_visitors").attr('data-flag-title').trim();
	var query = new AV.Query(Counter);
	query.equalTo("url", url);
	query.find({
		success: function(results) {
			if (results.length > 0) {
				var counter = results[0];
				counter.fetchWhenSave(true);
				counter.increment("time");
				counter.save(null, {
					success: function(counter) {
						var content = $(document.getElementById(url)).text() + ': ' + counter.get('time');
						$(document.getElementById(url)).text(content);
					},
					error: function(counter, error) {
						console.log('Failed to save Visitor num, with error message: ' + error.message);
					}
				});
			} else {
				var newcounter = new Counter();
				newcounter.set("title", title);
				newcounter.set("url", url);
				newcounter.set("time", 1);
				newcounter.save(null, {
					success: function(newcounter) {
					    console.log("newcounter.get('time')="+newcounter.get('time'));
						var content = $(document.getElementById(url)).text() + ': ' + newcounter.get('time');
						$(document.getElementById(url)).text(content);
					},
					error: function(newcounter, error) {
						console.log('Failed to create');
					}
				});
			}
		},
		error: function(error) {
			console.log('Error:' + error.code + " " + error.message);
		}
	});
}
$(function() {
	var Counter = AV.Object.extend("Counter");
	if ($('.leancloud_visitors').length == 1) {
		addCount(Counter);
	} else if ($('.post-title-link').length > 1) {
		showTime(Counter);
	}
});
</script>

      
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  






  
  







  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/three.min.js"></script>
  

  
  
    <script type="text/javascript" src="/lib/three/canvas_lines.min.js"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  








  
    <script type="text/javascript">
      (function(d, s) {
        var j, e = d.getElementsByTagName(s)[0];
        if (typeof LivereTower === 'function') { return; }
        j = d.createElement(s);
        j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
        j.async = true;
        e.parentNode.insertBefore(j, e);
      })(document, 'script');
    </script>
  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("aUG4vd9Krriqy647ANRoSSer-gzGzoHsz", "kdMloa4KY0uLCvse71kG5F7x");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

</body>
</html>
